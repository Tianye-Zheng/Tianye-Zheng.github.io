---
layout: post
title:  "项目"
date:   2019-11-14
desc: ""
keywords: ""
categories: [Java]
tags: []
icon: icon-html
---
牛客网首页讨论区实战项目项目小结

技术架构

+ Spring Boot

+ Spring、Spring MVC、MyBatis

+ Redis、Kafka、Elasticsearch

+ Spring Security、Spring Actuator


开发环境

+ 构建工具： Apache Maven

+ 集成开发工具： Intellij IDEA

+ 数据库： MySQL、Redis

+ 应用服务器： Apache Tomcat

+ 版本控制工具： Git


创建项目时配置好 Maven，创建新的 Maven 项目，选择官方模板 archetype-quickstart

Spring Initializer ：创建 Spring Boot 项目的引导工具，底层基于 Maven，对包进行了整合，更方便管理

<br />
**Spring Boot 核心作用**

+ **起步依赖**

+ **自动配置**

+ **端点监控**

<br />
**Spring 全家桶**

+ **Spring Framework**

+ **Spring Boot**

+ **Spring Cloud**

+ **Spring Cloud Data Flow**

<br />
**Spring Framework**

+ **Spring Core —— IoC 、 AOP** ： 管理对象的思想

+ **Spring Data Access —— Transactions、Spring MyBatis**

+ **Web Servlet —— Spring MVC** ： web 开发

+ **Integration —— Email、Scheduling、AMQP、Security**

<br />
**Spring IoC**

+ **Inversion of Control** ： 控制反转，是一种面向对象编程的设计思想

+ **Dependency Injection** ： 依赖注入，是 IoC 思想的实现方式

+ **IoC Container** ： IoC 容器，是实现依赖注入的关键，本质上是一个工厂

一个类想要引用 Spring 容器 ： 实现 ApplicationContextAware 接口，实现 setApplicationContext 方法

项目中 controller，service，dao 之间的依赖关系就可以使用依赖注入来实现

<br />
**Spring MVC**

+ 三层架构 ： 表现层、业务层、数据访问层

+ MVC ： Model 模型层、 View 视图层、 Controller 控制层

+ 核心层 ： 前端控制器 **DispatcherServlet**

<div><img src="https://raw.githubusercontent.com/Tianye-Zheng/Tianye-Zheng.github.io/master/PostPictures/2019-winter/6.png" width = "430" height =
"400" /></div>

MVC 主要解决表现层的问题，当浏览器发送请求访问服务器时，访问的是 Controller 控制器，它会接收请求中的数据调用业务层处理，处理完后会将得到的数据封装到 Model 里面，然后传给视图层，然后视图层利用 Model 数据生成一个 Html 返回给浏览器

<div><img src="https://raw.githubusercontent.com/Tianye-Zheng/Tianye-Zheng.github.io/master/PostPictures/2019-winter/7.png" width = "430" height =
"400" /></div>

<br />
**GET 请求传参的两种方式**

```
// GET 请求传参在明面上传，而且传的参数量有限

// /students?current=1&limit=20
@RequestMapping(path="/students", method = RequestMethod.GET)
@ResponseBody
public String getStudents(
		@RequestParam(name = "current", required = false, defaultValue = "1") int current, 
		@RequestParam(name = "limit", required = false, defaultValue = "10") int limit) {
	System.out.println(current);
	System.out.println(limit);
	return "some students";		
}

// /student/123
@RequestMapping(path = "/student/{id}", method = RequestMethod.GET)
@ResponseBody
public String getStudent(@PathVariable("id") int id) {
	System.out.println(id)
	return "a student";
}

// POST 请求方法参数和表单上的名字一致就会自动传参
```

```
// 响应 JSON 数据（ 异步请求 ）
// Java 对象 -> JSON 字符串 -> JS 对象

@RequestMapping(path = "/emp", method = RequestMethod.GET)
@ResponseBody
public Map<String, Object> getEmp() {
	Map<String, Object> emp = new HashMap<>();
	emp.put("name","张三");
	emp.put("age",23);
	emp.put("salary",8000);
	return emp;
}
// dispatcherServlet 看见 responsebody 注解并且返回值是 map 会将 map 自动转换成 JSON 字符串发送给浏览器
```
<br />
**MyBatis 核心组件**

+ `SqlSessionFactory` : 用于创建 SqlSession 的工厂类
+ `SqlSession` : MyBatis 核心组件，用于向数据库执行 SQL
+ 主配置文件 : XML 配置文件，可以对 MyBatis 的底层行为作出详细的配置
+ Mapper 接口 : 就是 DAO 接口，在 MyBatis 中习惯性的称之为 Mapper
+ Mapper 映射器 : 用于编写 SQL，并将 SQL 和实体类映射的组件，采用 XML、注解均可实现



`账号设置`
<br />
### 想问下老师，controller中的 return “redirect:/index" 和  return “site/index" ，有什么区别呢？

return “/site/index”是返回一个模板路径，本次请求没有处理完，DispatcherServlet会将Model中的数据和对应的模板提交给模板引擎，让它继续处理完这次请求。return "redirect:/index"是重定向，表示本次请求已经处理完毕，但是没有什么合适的数据展现给客户端，建议客户端再发一次请求，访问"/index"以获得合适的数据。

kafka

手动指定 kafka 安装目录下的 data 文件储存数据

由于 kafka 依赖于 zookeeper，先启动 zookeeper，并指定配置文件

./zookeeper-server-start.sh ../config/zookeeper.propertiees

再启动 kafka 服务器，并指定配置文件：

./kafka-server-start.sh ../config/server.properties

创建名为 comment 的主题

./kafka-topics.sh --create --bootstrap-server localhost:9092 --replication-factor 1 --partitions 1 --topic comment

查看主题

./kafka-topics.sh --list --bootstrap-server localhost:9092

关于Kafka使用的重要提示

现象：在windows的命令行里启动kafka之后，当关闭命令行窗口时，就会强制关闭kafka。这种关闭方式为暴力关闭，很可能会导致kafka无法完成对日志文件的解锁。届时，再次启动kafka的时候，就会提示日志文件被锁，无法成功启动。

方案：将kafka的日志文件全部删除，再次启动即可。

建议：不要暴力关闭kafka，建议通过在命令行执行kafka-server-stop命令来关闭它。

其他：将来在Linux上部署kafka之后，采用后台运行的方式，就会避免这样的问题。


Elastic Search

启动ES的服务器：运行bin目录下的 elasticsearch 文件

查看健康状态： curl -X GET "localhost:9200/_cat/health?v"

查看节点状态： curl -X GET "localhost:9200/_cat/nodes?v"

查看索引：curl -X GET "localhost:9200/_cat/indices?v"

创建索引，名为 test：curl -X PUT "localhost:9200/test"

删除索引：curl -X DELETE "localhost:9200/test"


ES在启动时，默认申请1g内存，在学习阶段，这太耗内存了，可以调小一点。大家可以修改其 config 目录下的 jvm.options 文件，将初识内存调整为256m，将最大内存调整为512m


Spring Security

Spring Security 是一个专注为 Java 应用程序提供身份认证和授权的框架，它的强大之处在于它可以轻松扩展以满足自定义的需求

生成长图功能

使用了小工具 wkhtmltopdf/wkhtmltoimages ，安装在 /usr/local/bin 目录下

将特定网站内容生成为 pdf 文件或者图片

`wkhtmltopdf https://www.nowcoder.com /Users/zhengtianye/Desktop/data/wk-pdfs/1.pdf`

`wkhtmltoimage --quality 75 https://www.baidu.com /Users/zhengtianye/Desktop/data/wk-images/1.png`

（ 压缩程度为 75% ）